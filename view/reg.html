<link rel="stylesheet" type="text/css" href="<?php echo $system->ini_get('styles_url');?>reg.css" />
<div id="main" class="block">
	<h1>
		请填写下列信息完成注册
	</h1>
	<div class="button_div">
		<a href="<?php echo URLROOT;?>index/reg_for_key">使用邀请码注册</a>
		<a href="<?php echo URLROOT;?>index/login">直接登陆</a>
	</div>
	<div  class="info_input">
		用&nbsp;户&nbsp;名&nbsp;<input type="text" id="username"/><br/>
		密　　码<input type="password" id="password1"/><br/>
		确认密码<input type="password" id="password2"/><br/>
		验&nbsp;证&nbsp;码&nbsp;<img src=""/>
		=<input type="number" maxlength="3" size="3" id="add"/>
	</div>
	<div class="button_div"><a onclick="up()" href="#">检验并提交</a></div>
</div>
<script>
$('img')[0].onclick=function(){
	this.src="<?php echo URLROOT; ?>img/addition.php?name=<?php echo $system->ini_get('reg_ver_ses_name');?>&"+Math.random();
}
$('img')[0].onclick();
function up(){
		if(!$('#username').value){
			myScript.show('您必须输入您的用户名');
			return;
		}
		if(!$('#password1').value){
			myScript.show('您必须设置您的密码');
			return;
		}
		if($('#password1').value!=$('#password2').value){
			myScript.show('你两次输入的密码不一致，请检查');
			return;
		}
		if(!$('#add').value){
			myScript.show('您必须输入验证码');
			return;
		}
		var ajax=$.ajax();
		ajax.page='<?php echo URLROOT;?>p/reg';
		ajax.setCont({
			'username':$('#username').value,
			'password':$('#password1').value,
			'add':$('#add').value
		});
		ajax.callback=function(ajax){
			if(ajax.json){
				if(ajax.json.error){
					switch (ajax.json.error){
						case -1:
						var info='验证码错误';
						break;
						case 1:
						var info='用户名已存在，请换一个';
						break;
						default:
						var info='未知的错误代码'+ajax.json.error;
						break;
					}
					myScript.show(info);
					$('img')[0].onclick()
				}else{
					myScript.show('注册成功').onoff=function(){
						location.href='<?php echo URLROOT;?>';
					};
				}
			}else{
				myScript.show(ajax.text);
			}
		}
		ajax.send();
	}
</script>